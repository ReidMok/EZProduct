# 🚀 部署后立即执行 - Shopify 配置

## ✅ 当前状态

- ✅ Vercel 环境变量已配置（包括 `DATABASE_URL`）
- ✅ Vercel 正在自动重新部署（更新环境变量后）
- ⏳ 等待部署完成（通常 1-3 分钟）

---

## 📋 步骤 1：等待 Vercel 部署完成

### 1.1 检查部署状态

1. **打开 Vercel Dashboard**
   - 访问：https://vercel.com/dashboard
   - 进入你的项目 `shopify_ezproduct`

2. **查看最新部署**
   - 点击 **"Deployments"** 标签
   - 查看最新部署的状态：
     - 🟡 **Building** = 正在构建
     - 🟢 **Ready** = 构建成功
     - 🔴 **Error** = 构建失败

3. **等待状态变为 "Ready"**
   - 通常需要 1-3 分钟
   - 如果失败，检查错误日志

---

## 📋 步骤 2：更新 Shopify Partner Dashboard

### 2.1 登录 Shopify Partners

1. **访问 Shopify Partners**
   - 打开：https://partners.shopify.com/
   - 登录你的 Partner 账号

### 2.2 进入应用设置

1. **找到你的应用**
   - 点击左侧 **"应用分发"** (App Distribution)
   - 找到你的 **"EZProduct"** 应用
   - 点击应用名称进入

### 2.3 更新 App URL

1. **进入应用版本设置**
   - 点击 **"应用版本"** (App Versions) 标签
   - 点击你的应用版本（或创建新版本）

2. **更新 App URL**
   - 找到 **"App URL"** 字段
   - 改为：`https://shopifyezproduct.vercel.app`
   - 点击 **"Save"** 保存

### 2.4 更新 Redirect URLs（重要！）

1. **找到 Redirect URLs 设置**
   - 在同一个页面，找到 **"Allowed redirection URL(s)"** 或 **"重定向 URL"**
   - 点击 **"Add URL"** 或 **"添加 URL"**

2. **添加以下 3 个 URL**（每行一个）：

   ```
   https://shopifyezproduct.vercel.app/auth/callback
   https://shopifyezproduct.vercel.app/auth/shopify/callback
   https://shopifyezproduct.vercel.app/api/auth/callback
   ```

3. **保存更改**
   - 点击 **"Save"** 保存所有更改

### 2.5 验证配置

确认以下信息都正确：

- ✅ **App URL**: `https://shopifyezproduct.vercel.app`
- ✅ **Redirect URLs**: 包含上述 3 个 URL
- ✅ **API Key (Client ID)**: 与 Vercel 环境变量中的 `SHOPIFY_API_KEY` 一致
- ✅ **API Secret (Client Secret)**: 与 Vercel 环境变量中的 `SHOPIFY_API_SECRET` 一致

---

## 📋 步骤 3：在 Shopify 中安装应用

### 3.1 获取安装链接

1. **在 Shopify Partners Dashboard**
   - 进入你的应用
   - 点击 **"测试"** (Test) 或 **"开发"** (Development) 标签
   - 找到 **"测试链接"** (Test link) 或 **"Install link"**
   - 复制链接（格式：`https://partners.shopify.com/...`）

### 3.2 安装应用

1. **打开安装链接**
   - 在浏览器中打开复制的链接
   - 选择你的开发商店（如 `ezproduct-test-store.myshopify.com`）
   - 点击 **"安装"** (Install)

2. **授权应用**
   - Shopify 会显示应用请求的权限
   - 点击 **"安装应用"** (Install app) 确认授权

3. **完成安装**
   - 安装成功后，会自动跳转到应用界面
   - 你应该能看到 EZProduct 的主界面

---

## ✅ 完成后的验证

### 检查清单

- [ ] Vercel 部署状态为 "Ready"
- [ ] Shopify Partner Dashboard App URL 已更新
- [ ] Redirect URLs 已添加（3 个）
- [ ] 在 Shopify 中成功安装应用
- [ ] 应用界面正常显示

### 测试应用功能

1. **测试产品生成**
   - 在应用界面输入产品关键词（如："Three Divers Resin Night Light"）
   - 点击 "Generate & Sync Product"
   - 等待 AI 生成和同步完成
   - 检查 Shopify 后台是否创建了新产品

2. **检查生成的产品**
   - 进入 Shopify 后台 → **"产品"** (Products)
   - 找到刚创建的产品
   - 检查标题、描述、变体、价格等是否正确

---

## 🆘 常见问题

### 问题 1：OAuth 授权失败

**症状**：安装应用时显示 "Invalid redirect URI" 或 "OAuth error"

**解决**：
- 检查 Shopify Partner Dashboard 中的 Redirect URLs 是否完全匹配
- 确保 URL 使用 `https://`（不是 `http://`）
- 确保没有多余的空格或斜杠
- 确保 App URL 和 Redirect URLs 都已保存

### 问题 2：应用无法加载

**症状**：安装后显示空白页面或错误

**解决**：
- 检查 Vercel 部署状态是否为 "Ready"
- 检查 Vercel 环境变量是否都正确配置
- 查看 Vercel 的 Runtime Logs 查看错误信息

### 问题 3：数据库连接失败

**症状**：应用运行但无法保存数据

**解决**：
- 检查 `DATABASE_URL` 是否正确
- 如果密码有特殊字符，可能需要 URL 编码
- 在本地运行 `npm run db:migrate` 确认迁移成功

---

## 📝 快速参考

### Vercel 部署 URL
```
https://shopifyezproduct.vercel.app
```

### Shopify Partner Dashboard
```
https://partners.shopify.com/
```

### 需要添加的 Redirect URLs
```
https://shopifyezproduct.vercel.app/auth/callback
https://shopifyezproduct.vercel.app/auth/shopify/callback
https://shopifyezproduct.vercel.app/api/auth/callback
```

---

## 🎯 执行顺序

1. ✅ **等待 Vercel 部署完成**（状态变为 "Ready"）
2. ✅ **更新 Shopify Partner Dashboard**（App URL + Redirect URLs）
3. ✅ **在 Shopify 中安装应用**
4. ✅ **测试应用功能**

完成这些步骤后，你的 EZProduct 应用就可以在生产环境使用了！🎉




